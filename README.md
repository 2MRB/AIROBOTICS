# نظام إدارة الشكاوى البلدية

## نظرة عامة

نظام شامل لإدارة الشكاوى البلدية يتيح للمواطنين تقديم شكاوىهم ومتابعتها، وللإدارة والموظفين إدارة هذه الشكاوى.

## ✅ الحالة الحالية

النظام يعمل بشكل كامل! تم حل جميع المشاكل وإعداد البيانات الأولية مع نظام صلاحيات محكم.

## 🔒 نظام الصلاحيات المحسّن

### **الإداريين (ADMIN)**:

- ✅ رؤية جميع الشكاوى
- ✅ تخصيص الشكاوى للموظفين
- ✅ إدارة المستخدمين وأنواع الشكاوى
- ✅ تصدير البيانات والإحصائيات
- ✅ عرض تفاصيل كاملة للشكاوى

### **الموظفين (EMPLOYEE)**:

- ✅ رؤية الشكاوى المخصصة لهم فقط
- ✅ تحديث حالة الشكاوى المخصصة لهم
- ✅ عرض تفاصيل الشكاوى المخصصة لهم

### **المواطنين (CITIZEN)**:

- ✅ رؤية شكاويهم الخاصة فقط (محسّن)
- ✅ عرض تفاصيل شكاويهم
- ✅ تقديم شكاوى جديدة
- ✅ **تسجيل دخول تلقائي بعد تقديم الشكوى**
- ✅ **لا يمكنهم رؤية شكاوى الآخرين مطلقاً**
- ✅ **تحقق من التوكن في كل طلب**

## 🚀 التشغيل السريع

### 1. تثبيت المتطلبات

```bash
npm install
cd server && npm install
```

### 2. إعداد قاعدة البيانات

```bash
npx prisma db push
node prisma/seed.cjs
```

### 3. تشغيل الخوادم

```bash
# تشغيل الخادم الخلفي
cd server && npm start

# تشغيل الواجهة الأمامية (في terminal آخر)
npm run dev
```

### 4. الوصول للنظام

- **الواجهة الأمامية:** http://localhost:5173
- **الخادم الخلفي:** http://localhost:3001

## 👤 حسابات الإدارة

### الحساب الأول:

- **البريد الإلكتروني:** emanhassanmahmoud1@gmail.com
- **كلمة المرور:** Emovmmm#951753
- **الاسم:** إيمان حسن محمود

### الحساب الثاني:

- **البريد الإلكتروني:** karemelolary8@gmail.com
- **كلمة المرور:** Emovmmm#951753
- **الاسم:** كريم العكري

## 🔧 المميزات الجديدة

### للمواطنين:

- ✅ تسجيل الدخول بالرقم القومي
- ✅ رؤية شكاويهم الخاصة فقط
- ✅ عرض تفاصيل كاملة لشكاويهم
- ✅ تقديم شكاوى جديدة مع إرفاق ملفات
- ✅ متابعة حالة الشكاوى

### للإدارة:

- ✅ لوحة تحكم شاملة مع تبويب الشكاوى
- ✅ عرض تفاصيل كاملة للشكاوى
- ✅ تخصيص الشكاوى للموظفين
- ✅ إدارة المستخدمين وأنواع الشكاوى
- ✅ تصدير البيانات والإحصائيات
- ✅ رؤية جميع الشكاوى

### للموظفين:

- ✅ رؤية الشكاوى المخصصة لهم فقط
- ✅ تحديث حالة الشكاوى المخصصة لهم
- ✅ عرض تفاصيل الشكاوى المخصصة لهم
- ✅ واجهة بسيطة وسهلة الاستخدام

## إعداد البريد الإلكتروني

لتفعيل إرسال الإشعارات، قم بإنشاء ملف `.env` في مجلد `server`:

```env
EMAIL_USER=your-email@gmail.com
EMAIL_PASS=your-app-password
JWT_SECRET=your-secret-key-change-in-production
FRONTEND_URL=http://localhost:5173
NODE_ENV=development
```

## أنواع الشكاوى المتاحة

- 🏚️ شكوى بناء مخالف
- 🚽 شكوى صرف صحي
- ♻️ شكوى نظافة أو قمامة
- 🚧 شكوى طريق أو رصف
- 💡 شكوى إنارة
- 📶 شكوى ضعف أو انقطاع الإنترنت
- 🌳 شكوى تعديات على ممتلكات عامة
- 🛠️ شكوى صيانة أو كهرباء
- 🚓 شكوى أمنية أو تعدي
- ✉️ أخرى (مع تحديد التفاصيل)

## حالات الشكاوى

- **جديدة (NEW):** شكوى حديثة التقديم
- **قيد المراجعة (UNDER_REVIEW):** قيد فحص الإدارة
- **قيد التنفيذ (IN_PROGRESS):** قيد المعالجة
- **تم الحل (RESOLVED):** تم حل المشكلة
- **مرفوضة (REJECTED):** مرفوضة من الإدارة
- **مغلقة (CLOSED):** مغلقة نهائياً

## الأمان

- ✅ مصادقة JWT للمستخدمين
- ✅ تشفير كلمات المرور
- ✅ تحقق من الأدوار والصلاحيات
- ✅ حماية من هجمات CSRF وXSS
- ✅ Rate limiting
- ✅ **تحكم في الوصول حسب الدور**
- ✅ **المواطنين يرون شكاويهم فقط (محسّن)**
- ✅ **الموظفين يرون الشكاوى المخصصة لهم فقط**
- ✅ **الإداريين يرون جميع الشكاوى**
- ✅ **تحقق من الصلاحيات في كل طلب**
- ✅ **حماية من الوصول غير المصرح للشكاوى**

## التقنيات المستخدمة

### الواجهة الأمامية:

- React 18
- TypeScript
- Tailwind CSS
- Vite
- Lucide React Icons

### الخادم الخلفي:

- Node.js
- Express.js
- Prisma ORM
- SQLite
- JWT Authentication
- Multer (لرفع الملفات)
- Nodemailer (لإرسال البريد الإلكتروني)

## الدعم

لأي استفسارات أو مشاكل، يرجى التواصل مع فريق التطوير.

## 📋 دليل الإعداد التفصيلي

راجع ملف `SETUP.md` للحصول على دليل إعداد مفصل.
